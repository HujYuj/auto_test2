/**
 * sifter.js
 * Copyright (c) 2013 Brian Reavis & contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at:
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 *
 * @author Brian Reavis <brian@thirdroute.com>
 */

!function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){function t(t,e){this.items=t,this.settings=e||{diacritics:!0}}t.prototype.tokenize=function(t){if(!(t=a(String(t||"").toLowerCase()))||!t.length)return[];var e,i,n,o,s=[],r=t.split(/ +/);for(e=0,i=r.length;e<i;e++){if(n=l(r[e]),this.settings.diacritics)for(o in p)p.hasOwnProperty(o)&&(n=n.replace(new RegExp(o,"g"),p[o]));s.push({string:r[e],regex:new RegExp(n,"i")})}return s},t.prototype.iterator=function(t,e){(r(t)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;e<i;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var o,s,r,a;t=this.prepareSearch(t,e),s=t.tokens,o=t.options.fields,r=s.length,a=t.options.nesting;function l(t,e){var i,n;return t?-1===(n=(t=String(t||"")).search(e.regex))?0:(i=e.string.length/t.length,0===n&&(i+=.5),i):0}var p,u=(p=o.length)?1===p?function(t,e){return l(g(e,o[0],a),t)}:function(t,e){for(var i=0,n=0;i<p;i++)n+=l(g(e,o[i],a),t);return n/p}:function(){return 0};return r?1===r?function(t){return u(s[0],t)}:"and"===t.options.conjunction?function(t){for(var e,i=0,n=0;i<r;i++){if((e=u(s[i],t))<=0)return 0;n+=e}return n/r}:function(t){for(var e=0,i=0;e<r;e++)i+=u(s[e],t);return i/r}:function(){return 0}},t.prototype.getSortFunction=function(t,i){var e,n,o,s,r,a,l,p,u,d,c;if(c=!(t=(o=this).prepareSearch(t,i)).query&&i.sort_empty||i.sort,u=function(t,e){return"$score"===t?e.score:g(o.items[e.id],t,i.nesting)},r=[],c)for(e=0,n=c.length;e<n;e++)!t.query&&"$score"===c[e].field||r.push(c[e]);if(t.query){for(d=!0,e=0,n=r.length;e<n;e++)if("$score"===r[e].field){d=!1;break}d&&r.unshift({field:"$score",direction:"desc"})}else for(e=0,n=r.length;e<n;e++)if("$score"===r[e].field){r.splice(e,1);break}for(p=[],e=0,n=r.length;e<n;e++)p.push("desc"===r[e].direction?-1:1);return(a=r.length)?1===a?(s=r[0].field,l=p[0],function(t,e){return l*h(u(s,t),u(s,e))}):function(t,e){var i,n,o;for(i=0;i<a;i++)if(o=r[i].field,n=p[i]*h(u(o,t),u(o,e)))return n;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;var i=(e=s({},e)).fields,n=e.sort,o=e.sort_empty;return i&&!r(i)&&(e.fields=[i]),n&&!r(n)&&(e.sort=[n]),o&&!r(o)&&(e.sort_empty=[o]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,i){var n,o,e,s,r=this;return o=this.prepareSearch(t,i),i=o.options,t=o.query,s=i.score||r.getScoreFunction(o),t.length?r.iterator(r.items,function(t,e){n=s(t),(!1===i.filter||0<n)&&o.items.push({score:n,id:e})}):r.iterator(r.items,function(t,e){o.items.push({score:1,id:e})}),(e=r.getSortFunction(o,i))&&o.items.sort(e),o.total=o.items.length,"number"==typeof i.limit&&(o.items=o.items.slice(0,i.limit)),o};var h=function(t,e){return"number"==typeof t&&"number"==typeof e?e<t?1:t<e?-1:0:(t=i(String(t||"")),(e=i(String(e||"")))<t?1:t<e?-1:0)},s=function(t,e){var i,n,o,s;for(i=1,n=arguments.length;i<n;i++)if(s=arguments[i])for(o in s)s.hasOwnProperty(o)&&(t[o]=s[o]);return t},g=function(t,e,i){if(t&&e){if(!i)return t[e];for(var n=e.split(".");n.length&&(t=t[n.shift()]););return t}},a=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},l=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},r=Array.isArray||"undefined"!=typeof $&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},p={a:"[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]",b:"[b␢βΒB฿𐌁ᛒ]",c:"[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]",d:"[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]",e:"[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]",f:"[fƑƒḞḟ]",g:"[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]",h:"[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]",i:"[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]",j:"[jȷĴĵɈɉʝɟʲ]",k:"[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]",l:"[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]",n:"[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]",o:"[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]",p:"[pṔṕṖṗⱣᵽƤƥᵱ]",q:"[qꝖꝗʠɊɋꝘꝙq̃]",r:"[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]",s:"[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]",t:"[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]",u:"[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]",v:"[vṼṽṾṿƲʋꝞꝟⱱʋ]",w:"[wẂẃẀẁŴŵẄẅẆẇẈẉ]",x:"[xẌẍẊẋχ]",y:"[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]",z:"[zŹźẐẑŽžŻżẒẓẔẕƵƶ]"},i=function(){var t,e,i,n,o="",s={};for(i in p)if(p.hasOwnProperty(i))for(o+=n=p[i].substring(2,p[i].length-1),t=0,e=n.length;t<e;t++)s[n.charAt(t)]=i;var r=new RegExp("["+o+"]","g");return function(t){return t.replace(r,function(t){return s[t]}).toLowerCase()}}();return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={mixin:function(n){n.plugins={},n.prototype.initializePlugins=function(t){var e,i,n,o=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},s.isArray(t))for(e=0,i=t.length;e<i;e++)"string"==typeof t[e]?o.push(t[e]):(this.plugins.settings[t[e].name]=t[e].options,o.push(t[e].name));else if(t)for(n in t)t.hasOwnProperty(n)&&(this.plugins.settings[n]=t[n],o.push(n));for(;o.length;)this.require(o.shift())},n.prototype.loadPlugin=function(t){var e=this.plugins,i=n.plugins[t];if(!n.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');e.requested[t]=!0,e.loaded[t]=i.fn.apply(this,[this.plugins.settings[t]||{}]),e.names.push(t)},n.prototype.require=function(t){var e=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return e.loaded[t]},n.define=function(t,e){n.plugins[t]={name:t,fn:e}}}},s={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(x,d,t){"use strict";function S(t,e){if("string"!=typeof e||e.length){var l="string"==typeof e?new RegExp(e,"i"):e,p=function(t){var e=0;if(3===t.nodeType){var i=t.data.search(l);if(0<=i&&0<t.data.length){var n=t.data.match(l),o=document.createElement("span");o.className="highlight";var s=t.splitText(i),r=(s.splitText(n[0].length),s.cloneNode(!0));o.appendChild(r),s.parentNode.replaceChild(o,s),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&("highlight"!==t.className||"SPAN"!==t.tagName))for(var a=0;a<t.childNodes.length;++a)a+=p(t.childNodes[a]);return e};return t.each(function(){p(this)})}}x.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var t=this.parentNode;t.replaceChild(this.firstChild,this),t.normalize()}).end()};function n(){}n.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(t){for(var e=["on","off","trigger"],i=0;i<e.length;i++)t.prototype[e[i]]=n.prototype[e[i]]};function p(t){return void 0!==t}function I(t){return null==t?null:"boolean"==typeof t?t?"1":"0":t+""}function a(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function i(e,i,t){var n,o=e.trigger,s={};for(n in e.trigger=function(){var t=arguments[0];if(-1===i.indexOf(t))return o.apply(e,arguments);s[t]=arguments},t.apply(e,[]),e.trigger=o,s)s.hasOwnProperty(n)&&o.apply(e,s[n])}function g(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var i=document.selection.createRange(),n=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-n,e.length=n}return e}function $(c){function t(t,e){var i,n,o,s,r,a,l,p,u,d;e=e||{},(t=t||window.event||{}).metaKey||t.altKey||!e.force&&!1===c.data("grow")||(i=c.val(),t.type&&"keydown"===t.type.toLowerCase()&&(o=48<=(n=t.keyCode)&&n<=57||65<=n&&n<=90||96<=n&&n<=111||186<=n&&n<=222||32===n,46===n||8===n?(p=g(c[0])).length?i=i.substring(0,p.start)+i.substring(p.start+p.length):8===n&&p.start?i=i.substring(0,p.start-1)+i.substring(p.start+1):46===n&&void 0!==p.start&&(i=i.substring(0,p.start)+i.substring(p.start+1)):o&&(a=t.shiftKey,l=String.fromCharCode(t.keyCode),i+=l=a?l.toUpperCase():l.toLowerCase())),s=c.attr("placeholder"),!i&&s&&(i=s),d=c,(r=((u=i)?(w.$testInput||(w.$testInput=x("<span />").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).appendTo("body")),w.$testInput.text(u),function(t,e,i){var n,o,s={};if(i)for(n=0,o=i.length;n<o;n++)s[i[n]]=t.css(i[n]);else s=t.css();e.css(s)}(d,w.$testInput,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]),w.$testInput.width()):0)+4)!==h&&(h=r,c.width(r),c.triggerHandler("resize")))}var h=null;c.on("keydown keyup update blur",t),t()}var C=/Mac/.test(navigator.userAgent),b=C?91:17,_=C?18:17,F=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity,e={before:function(t,e,i){var n=t[e];t[e]=function(){return i.apply(t,arguments),n.apply(t,arguments)}},after:function(e,t,i){var n=e[t];e[t]=function(){var t=n.apply(e,arguments);return i.apply(e,arguments),t}}},w=function(t,e){var i,n,o,s,r=this;(s=t[0]).selectize=r;var a,l,p,u=window.getComputedStyle&&window.getComputedStyle(s,null);if(o=(o=u?u.getPropertyValue("direction"):s.currentStyle&&s.currentStyle.direction)||t.parents("[dir]:first").attr("dir")||"",x.extend(r,{order:0,settings:e,$input:t,tabIndex:t.attr("tabindex")||"",tagType:"select"===s.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(o),eventNS:".selectize"+ ++w.count,highlightedValue:null,isBlurring:!1,isOpen:!1,isDisabled:!1,isRequired:t.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===e.loadThrottle?r.onSearchChange:(a=r.onSearchChange,l=e.loadThrottle,function(){var t=this,e=arguments;window.clearTimeout(p),p=window.setTimeout(function(){a.apply(t,e)},l)})}),r.sifter=new d(this.options,{diacritics:e.diacritics}),r.settings.options){for(i=0,n=r.settings.options.length;i<n;i++)r.registerOption(r.settings.options[i]);delete r.settings.options}if(r.settings.optgroups){for(i=0,n=r.settings.optgroups.length;i<n;i++)r.registerOptionGroup(r.settings.optgroups[i]);delete r.settings.optgroups}r.settings.mode=r.settings.mode||(1===r.settings.maxItems?"single":"multi"),"boolean"!=typeof r.settings.hideSelected&&(r.settings.hideSelected="multi"===r.settings.mode),r.initializePlugins(r.settings.plugins),r.setupCallbacks(),r.setupTemplates(),r.setup()};return n.mixin(w),void 0!==t?t.mixin(w):function(t,e){e=e||{};console.error("Selectize: "+t),e.explanation&&(console.group&&console.group(),console.error(e.explanation),console.group&&console.groupEnd())}("Dependency MicroPlugin is missing",{explanation:'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.'}),x.extend(w.prototype,{setup:function(){var t,e,i,n,o,s,r,a,l,p,u,d,c,h,g=this,f=g.settings,v=g.eventNS,m=x(window),y=x(document),w=g.$input;if(r=g.settings.mode,a=w.attr("class")||"",t=x("<div>").addClass(f.wrapperClass).addClass(a).addClass(r),e=x("<div>").addClass(f.inputClass).addClass("items").appendTo(t),i=x('<input type="text" autocomplete="off" />').appendTo(e).attr("tabindex",w.is(":disabled")?"-1":g.tabIndex),s=x(f.dropdownParent||t),n=x("<div>").addClass(f.dropdownClass).addClass(r).hide().appendTo(s),o=x("<div>").addClass(f.dropdownContentClass).appendTo(n),(p=w.attr("id"))&&(i.attr("id",p+"-selectized"),x("label[for='"+p+"']").attr("for",p+"-selectized")),g.settings.copyClassesToDropdown&&n.addClass(a),t.css({width:w[0].style.width}),g.plugins.names.length&&(l="plugin-"+g.plugins.names.join(" plugin-"),t.addClass(l),n.addClass(l)),(null===f.maxItems||1<f.maxItems)&&1===g.tagType&&w.attr("multiple","multiple"),g.settings.placeholder&&i.attr("placeholder",f.placeholder),!g.settings.splitOn&&g.settings.delimiter){var O=g.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");g.settings.splitOn=new RegExp("\\s*"+O+"+\\s*")}w.attr("autocorrect")&&i.attr("autocorrect",w.attr("autocorrect")),w.attr("autocapitalize")&&i.attr("autocapitalize",w.attr("autocapitalize")),i[0].type=w[0].type,g.$wrapper=t,g.$control=e,g.$control_input=i,g.$dropdown=n,g.$dropdown_content=o,n.on("mouseenter mousedown click","[data-disabled]>[data-selectable]",function(t){t.stopImmediatePropagation()}),n.on("mouseenter","[data-selectable]",function(){return g.onOptionHover.apply(g,arguments)}),n.on("mousedown click","[data-selectable]",function(){return g.onOptionSelect.apply(g,arguments)}),d="mousedown",c="*:not(input)",h=function(){return g.onItemSelect.apply(g,arguments)},(u=e).on(d,c,function(t){for(var e=t.target;e&&e.parentNode!==u[0];)e=e.parentNode;return t.currentTarget=e,h.apply(this,[t])}),$(i),e.on({mousedown:function(){return g.onMouseDown.apply(g,arguments)},click:function(){return g.onClick.apply(g,arguments)}}),i.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return g.onKeyDown.apply(g,arguments)},keyup:function(){return g.onKeyUp.apply(g,arguments)},keypress:function(){return g.onKeyPress.apply(g,arguments)},resize:function(){g.positionDropdown.apply(g,[])},blur:function(){return g.onBlur.apply(g,arguments)},focus:function(){return g.ignoreBlur=!1,g.onFocus.apply(g,arguments)},paste:function(){return g.onPaste.apply(g,arguments)}}),y.on("keydown"+v,function(t){g.isCmdDown=t[C?"metaKey":"ctrlKey"],g.isCtrlDown=t[C?"altKey":"ctrlKey"],g.isShiftDown=t.shiftKey}),y.on("keyup"+v,function(t){t.keyCode===_&&(g.isCtrlDown=!1),16===t.keyCode&&(g.isShiftDown=!1),t.keyCode===b&&(g.isCmdDown=!1)}),y.on("mousedown"+v,function(t){if(g.isFocused){if(t.target===g.$dropdown[0]||t.target.parentNode===g.$dropdown[0])return!1;g.$control.has(t.target).length||t.target===g.$control[0]||g.blur(t.target)}}),m.on(["scroll"+v,"resize"+v].join(" "),function(){g.isOpen&&g.positionDropdown.apply(g,arguments)}),m.on("mousemove"+v,function(){g.ignoreHover=!1}),this.revertSettings={$children:w.children().detach(),tabindex:w.attr("tabindex")},w.attr("tabindex",-1).hide().after(g.$wrapper),x.isArray(f.items)&&(g.setValue(f.items),delete f.items),F&&w.on("invalid"+v,function(t){t.preventDefault(),g.isInvalid=!0,g.refreshState()}),g.updateOriginalInput(),g.refreshItems(),g.refreshState(),g.updatePlaceholder(),g.isSetup=!0,w.is(":disabled")&&g.disable(),g.on("change",this.onChange),w.data("selectize",g),w.addClass("selectized"),g.trigger("initialize"),!0===f.preload&&g.onSearchChange("")},setupTemplates:function(){var i=this.settings.labelField,n=this.settings.optgroupLabelField,t={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[n])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[i])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[i])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=x.extend({},t,this.settings.render)},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]])&&this.on(t,e)},onClick:function(t){this.isFocused&&this.isOpen||(this.focus(),t.preventDefault())},onMouseDown:function(t){var e=this,i=t.isDefaultPrevented();x(t.target);if(e.isFocused){if(t.target!==e.$control_input[0])return"single"===e.settings.mode?e.isOpen?e.close():e.open():i||e.setActiveItem(null),!1}else i||window.setTimeout(function(){e.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var o=this;o.isFull()||o.isInputHidden||o.isLocked?t.preventDefault():o.settings.splitOn&&setTimeout(function(){var t=o.$control_input.val();if(t.match(o.settings.splitOn))for(var e=x.trim(t).split(o.settings.splitOn),i=0,n=e.length;i<n;i++)o.createItem(e[i])},0)},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){t.target,this.$control_input[0];var e=this;if(e.isLocked)9!==t.keyCode&&t.preventDefault();else{switch(t.keyCode){case 65:if(e.isCmdDown)return void e.selectAll();break;case 27:return void(e.isOpen&&(t.preventDefault(),t.stopPropagation(),e.close()));case 78:if(!t.ctrlKey||t.altKey)break;case 40:if(!e.isOpen&&e.hasOptions)e.open();else if(e.$activeOption){e.ignoreHover=!0;var i=e.getAdjacentOption(e.$activeOption,1);i.length&&e.setActiveOption(i,!0,!0)}return void t.preventDefault();case 80:if(!t.ctrlKey||t.altKey)break;case 38:if(e.$activeOption){e.ignoreHover=!0;var n=e.getAdjacentOption(e.$activeOption,-1);n.length&&e.setActiveOption(n,!0,!0)}return void t.preventDefault();case 13:return void(e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),t.preventDefault()));case 37:return void e.advanceSelection(-1,t);case 39:return void e.advanceSelection(1,t);case 9:return e.settings.selectOnTab&&e.isOpen&&e.$activeOption&&(e.onOptionSelect({currentTarget:e.$activeOption}),e.isFull()||t.preventDefault()),void(e.settings.create&&e.createItem()&&t.preventDefault());case 8:case 46:return void e.deleteSelection(t)}!e.isFull()&&!e.isInputHidden||(C?t.metaKey:t.ctrlKey)||t.preventDefault()}},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var i=e.$control_input.val()||"";e.lastValue!==i&&(e.lastValue=i,e.onSearchChange(i),e.refreshOptions(),e.trigger("type",i))},onSearchChange:function(e){var i=this,n=i.settings.load;n&&(i.loadedSearches.hasOwnProperty(e)||(i.loadedSearches[e]=!0,i.load(function(t){n.apply(i,[e,t])})))},onFocus:function(t){var e=this,i=e.isFocused;if(e.isDisabled)return e.blur(),t&&t.preventDefault(),!1;e.ignoreFocus||(e.isFocused=!0,"focus"===e.settings.preload&&e.onSearchChange(""),i||e.trigger("focus"),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState())},onBlur:function(t,e){var i=this;if(i.isFocused&&(i.isFocused=!1,!i.ignoreFocus)){if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0])return i.ignoreBlur=!0,void i.onFocus(t);var n=function(){i.close(),i.setTextboxValue(""),i.setActiveItem(null),i.setActiveOption(null),i.setCaret(i.items.length),i.refreshState(),e&&e.focus&&e.focus(),i.isBlurring=!1,i.ignoreFocus=!1,i.trigger("blur")};i.isBlurring=!0,i.ignoreFocus=!0,i.settings.create&&i.settings.createOnBlur?i.createItem(null,!1,n):n()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(t){var e,i,n=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),(i=x(t.currentTarget)).hasClass("create")?n.createItem(null,function(){n.settings.closeAfterSelect&&n.close()}):void 0!==(e=i.attr("data-value"))&&(n.lastQuery=null,n.setTextboxValue(""),n.addItem(e),n.settings.closeAfterSelect?n.close():!n.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&n.setActiveOption(n.getOption(e)))},onItemSelect:function(t){this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,i=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||i.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input;e.val()!==t&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){i(this,e?[]:["change"],function(){this.clear(e),this.addItems(t,e)})},getAllValues:function(){var i=[];return this.$wrapper.find("div.option").each(function(t){var e=x(this).attr("data-value");i.push(e)}),1===this.tagType&&this.$input.attr("multiple")?(x.merge(i,this.items),i):i.join(this.settings.delimiter)},getTextByValue:function(t){var e=this.$wrapper.find("div.option[data-value='"+t+"']");return(e=e||this.$wrapper.find("div.item[data-value='"+t+"']")).text()},getSize:function(){var t=this.$wrapper.find("div.option").length;return 1===this.tagType&&this.$input.attr("multiple")?t+this.items.length:t},setActiveItem:function(t,e){var i,n,o,s,r,a,l,p,u=this;if("single"!==u.settings.mode){if(!(t=x(t)).length)return x(u.$activeItems).removeClass("active"),u.$activeItems=[],void(u.isFocused&&u.showInput());if("mousedown"===(i=e&&e.type.toLowerCase())&&u.isShiftDown&&u.$activeItems.length){for(p=u.$control.children(".active:last"),s=Array.prototype.indexOf.apply(u.$control[0].childNodes,[p[0]]),(r=Array.prototype.indexOf.apply(u.$control[0].childNodes,[t[0]]))<s&&(l=s,s=r,r=l),n=s;n<=r;n++)a=u.$control[0].childNodes[n],-1===u.$activeItems.indexOf(a)&&(x(a).addClass("active"),u.$activeItems.push(a));e.preventDefault()}else"mousedown"===i&&u.isCtrlDown||"keydown"===i&&this.isShiftDown?t.hasClass("active")?(o=u.$activeItems.indexOf(t[0]),u.$activeItems.splice(o,1),t.removeClass("active")):u.$activeItems.push(t.addClass("active")[0]):(x(u.$activeItems).removeClass("active"),u.$activeItems=[t.addClass("active")[0]]);u.hideInput(),this.isFocused||u.focus()}},setActiveOption:function(t,e,i){var n,o,s,r,a,l=this;l.$activeOption&&l.$activeOption.removeClass("active"),l.$activeOption=null,(t=x(t)).length&&(l.$activeOption=t.addClass("active"),!e&&p(e)||(n=l.$dropdown_content.height(),o=l.$activeOption.outerHeight(!0),e=l.$dropdown_content.scrollTop()||0,a=(r=s=l.$activeOption.offset().top-l.$dropdown_content.offset().top+e)-n+o,n+e<s+o?l.$dropdown_content.stop().animate({scrollTop:a},i?l.settings.scrollDuration:0):s<e&&l.$dropdown_content.stop().animate({scrollTop:r},i?l.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(t){this.$control_input[0].blur(),this.onBlur(null,t)},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e,nesting:t.nesting}},search:function(t){var e,i,n,o=this,s=o.settings,r=this.getSearchOptions();if(s.score&&"function"!=typeof(n=o.settings.score.apply(this,[t])))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==o.lastQuery?(o.lastQuery=t,i=o.sifter.search(t,x.extend(r,{score:n})),o.currentResults=i):i=x.extend(!0,{},o.currentResults),s.hideSelected)for(e=i.items.length-1;0<=e;e--)-1!==o.items.indexOf(I(i.items[e].id))&&i.items.splice(e,1);return i},refreshOptions:function(t){var e,i,n,o,s,r,a,l,p,u,d,c,h,g,f,v;void 0===t&&(t=!0);var m,y,w=this,O=x.trim(w.$control_input.val()),$=w.search(O),C=w.$dropdown_content,b=w.$activeOption&&I(w.$activeOption.attr("data-value"));for(o=$.items.length,"number"==typeof w.settings.maxOptions&&(o=Math.min(o,w.settings.maxOptions)),s={},r=[],e=0;e<o;e++)for(a=w.options[$.items[e].id],l=w.render("option",a),p=a[w.settings.optgroupField]||"",i=0,n=(u=x.isArray(p)?p:[p])&&u.length;i<n;i++)p=u[i],w.optgroups.hasOwnProperty(p)||(p=""),s.hasOwnProperty(p)||(s[p]=document.createDocumentFragment(),r.push(p)),s[p].appendChild(l);for(this.settings.lockOptgroupOrder&&r.sort(function(t,e){return(w.optgroups[t].$order||0)-(w.optgroups[e].$order||0)}),d=document.createDocumentFragment(),e=0,o=r.length;e<o;e++)p=r[e],w.optgroups.hasOwnProperty(p)&&s[p].childNodes.length?((c=document.createDocumentFragment()).appendChild(w.render("optgroup_header",w.optgroups[p])),c.appendChild(s[p]),d.appendChild(w.render("optgroup",x.extend({},w.optgroups[p],{html:(m=c,y=void 0,(y=document.createElement("div")).appendChild(m.cloneNode(!0)),y.innerHTML),dom:c})))):d.appendChild(s[p]);if(C.html(d),w.settings.highlight&&(C.removeHighlight(),$.query.length&&$.tokens.length))for(e=0,o=$.tokens.length;e<o;e++)S(C,$.tokens[e].regex);if(!w.settings.hideSelected)for(e=0,o=w.items.length;e<o;e++)w.getOption(w.items[e]).addClass("selected");(h=w.canCreate(O))&&(C.prepend(w.render("option_create",{input:O})),v=x(C[0].childNodes[0])),w.hasOptions=0<$.items.length||h,w.hasOptions?(0<$.items.length?((f=b&&w.getOption(b))&&f.length?g=f:"single"===w.settings.mode&&w.items.length&&(g=w.getOption(w.items[0])),g&&g.length||(g=v&&!w.settings.addPrecedence?w.getAdjacentOption(v,1):C.find("[data-selectable]:first"))):g=v,w.setActiveOption(g),t&&!w.isOpen&&w.open()):(w.setActiveOption(null),t&&w.isOpen&&w.close())},addOption:function(t){var e,i,n,o=this;if(x.isArray(t))for(e=0,i=t.length;e<i;e++)o.addOption(t[e]);else(n=o.registerOption(t))&&(o.userOptions[n]=!0,o.lastQuery=null,o.trigger("option_add",n,t))},registerOption:function(t){var e=I(t[this.settings.valueField]);return null!=e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=I(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,e){var i,n,o,s,r,a,l,p=this;if(t=I(t),o=I(e[p.settings.valueField]),null!==t&&p.options.hasOwnProperty(t)){if("string"!=typeof o)throw new Error("Value must be set in option data");l=p.options[t].$order,o!==t&&(delete p.options[t],-1!==(s=p.items.indexOf(t))&&p.items.splice(s,1,o)),e.$order=e.$order||l,p.options[o]=e,r=p.renderCache.item,a=p.renderCache.option,r&&(delete r[t],delete r[o]),a&&(delete a[t],delete a[o]),-1!==p.items.indexOf(o)&&(i=p.getItem(t),n=x(p.render("item",e)),i.hasClass("active")&&n.addClass("active"),i.replaceWith(n)),p.lastQuery=null,p.isOpen&&p.refreshOptions(!1)}},removeOption:function(t,e){var i=this;t=I(t);var n=i.renderCache.item,o=i.renderCache.option;n&&delete n[t],o&&delete o[t],delete i.userOptions[t],delete i.options[t],i.lastQuery=null,i.trigger("option_remove",t),i.removeItem(t,e)},clearOptions:function(){var i=this;i.loadedSearches={},i.userOptions={},i.renderCache={};var n=i.options;x.each(i.options,function(t,e){-1==i.items.indexOf(t)&&delete n[t]}),i.options=i.sifter.items=n,i.lastQuery=null,i.trigger("option_clear")},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,e){var i=this.$dropdown.find("[data-selectable]"),n=i.index(t)+e;return 0<=n&&n<i.length?i.eq(n):x()},getElementWithValue:function(t,e){if(null!=(t=I(t)))for(var i=0,n=e.length;i<n;i++)if(e[i].getAttribute("data-value")===t)return x(e[i]);return x()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(t,e){this.buffer=document.createDocumentFragment();for(var i=this.$control[0].childNodes,n=0;n<i.length;n++)this.buffer.appendChild(i[n]);for(var o=x.isArray(t)?t:[t],s=(n=0,o.length);n<s;n++)this.isPending=n<s-1,this.addItem(o[n],e);var r=this.$control[0];r.insertBefore(this.buffer,r.firstChild),this.buffer=null},addItem:function(a,l){i(this,l?[]:["change"],function(){var t,e,i,n,o,s=this,r=s.settings.mode;a=I(a),-1===s.items.indexOf(a)?s.options.hasOwnProperty(a)&&("single"===r&&s.clear(l),"multi"===r&&s.isFull()||(t=x(s.render("item",s.options[a])),o=s.isFull(),s.items.splice(s.caretPos,0,a),s.insertAtCaret(t),s.isPending&&(o||!s.isFull())||s.refreshState(),s.isSetup&&(i=s.$dropdown_content.find("[data-selectable]"),s.isPending||(e=s.getOption(a),n=s.getAdjacentOption(e,1).attr("data-value"),s.refreshOptions(s.isFocused&&"single"!==r),n&&s.setActiveOption(s.getOption(n))),!i.length||s.isFull()?s.close():s.isPending||s.positionDropdown(),s.updatePlaceholder(),s.trigger("item_add",a,t),s.isPending||s.updateOriginalInput({silent:l})))):"single"===r&&s.close()})},removeItem:function(t,e){var i,n,o,s=this;i=t instanceof x?t:s.getItem(t),t=I(i.attr("data-value")),-1!==(n=s.items.indexOf(t))&&(i.remove(),i.hasClass("active")&&(o=s.$activeItems.indexOf(i[0]),s.$activeItems.splice(o,1)),s.items.splice(n,1),s.lastQuery=null,!s.settings.persist&&s.userOptions.hasOwnProperty(t)&&s.removeOption(t,e),n<s.caretPos&&s.setCaret(s.caretPos-1),s.refreshState(),s.updatePlaceholder(),s.updateOriginalInput({silent:e}),s.positionDropdown(),s.trigger("item_remove",t,i))},createItem:function(t,i){var n=this,o=n.caretPos;t=t||x.trim(n.$control_input.val()||"");var s=arguments[arguments.length-1];if("function"!=typeof s&&(s=function(){}),"boolean"!=typeof i&&(i=!0),!n.canCreate(t))return s(),!1;n.lock();var e,r,a="function"==typeof n.settings.create?this.settings.create:function(t){var e={};return e[n.settings.labelField]=t,e[n.settings.valueField]=t,e},l=(r=!(e=function(t){if(n.unlock(),!t||"object"!=typeof t)return s();var e=I(t[n.settings.valueField]);if("string"!=typeof e)return s();n.setTextboxValue(""),n.addOption(t),n.setCaret(o),n.addItem(e),n.refreshOptions(i&&"single"!==n.settings.mode),s(t)}),function(){r||(r=!0,e.apply(this,arguments))}),p=a.apply(this,[t,l]);return void 0!==p&&l(p),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var t=!this.items.length;this.isInvalid=t,this.$control_input.prop("required",t),this.$input.prop("required",!t)},refreshClasses:function(){var t=this,e=t.isFull(),i=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",i).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!x.isEmptyObject(t.options)).toggleClass("has-items",0<t.items.length),t.$control_input.data("grow",!e&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,i,n,o,s=this;if(t=t||{},1===s.tagType){for(n=[],e=0,i=s.items.length;e<i;e++)o=s.options[s.items[e]][s.settings.labelField]||"",n.push('<option value="'+a(s.items[e])+'" selected="selected">'+a(o)+"</option>");n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),s.$input.html(n.join(""))}else s.$input.val(s.getValue()),s.$input.attr("value",s.$input.val());s.isSetup&&(t.silent||s.trigger("change",s.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this;if(!t.settings.isList){var e=t.isOpen;"single"===t.settings.mode&&t.items.length&&(t.hideInput(),t.isBlurring||t.$control_input.blur()),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)}},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t[0].getBoundingClientRect().width,top:e.top,left:e.left})},clear:function(t){var e=this;e.items.length&&(e.$control.children(":not(input)").remove(),e.items=[],e.lastQuery=null,e.setCaret(0),e.setActiveItem(null),e.updatePlaceholder(),e.updateOriginalInput({silent:t}),e.refreshState(),e.showInput(),e.trigger("clear"))},insertAtCaret:function(t){var e=Math.min(this.caretPos,this.items.length),i=t[0],n=this.buffer||this.$control[0];0===e?n.insertBefore(i,n.firstChild):n.insertBefore(i,n.childNodes[e]),this.setCaret(e+1)},deleteSelection:function(t){var e,i,n,o,s,r,a,l,p,u=this;if(n=t&&8===t.keyCode?-1:1,o=g(u.$control_input[0]),u.$activeOption&&!u.settings.hideSelected&&(a=u.getAdjacentOption(u.$activeOption,-1).attr("data-value")),s=[],u.$activeItems.length){for(p=u.$control.children(".active:"+(0<n?"last":"first")),r=u.$control.children(":not(input)").index(p),0<n&&r++,e=0,i=u.$activeItems.length;e<i;e++)s.push(x(u.$activeItems[e]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(u.isFocused||"single"===u.settings.mode)&&u.items.length&&(n<0&&0===o.start&&0===o.length?s.push(u.items[u.caretPos-1]):0<n&&o.start===u.$control_input.val().length&&s.push(u.items[u.caretPos]));if(!s.length||"function"==typeof u.settings.onDelete&&!1===u.settings.onDelete.apply(u,[s]))return!1;for(void 0!==r&&u.setCaret(r);s.length;)u.removeItem(s.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!0),a&&(l=u.getOption(a)).length&&u.setActiveOption(l),!0},advanceSelection:function(t,e){var i,n,o,s,r,a=this;0!==t&&(a.rtl&&(t*=-1),i=0<t?"last":"first",n=g(a.$control_input[0]),a.isFocused&&!a.isInputHidden?(s=a.$control_input.val().length,(t<0?0!==n.start||0!==n.length:n.start!==s)||s||a.advanceCaret(t,e)):(r=a.$control.children(".active:"+i)).length&&(o=a.$control.children(":not(input)").index(r),a.setActiveItem(null),a.setCaret(0<t?o+1:o)))},advanceCaret:function(t,e){var i,n,o=this;0!==t&&(i=0<t?"next":"prev",o.isShiftDown?(n=o.$control_input[i]()).length&&(o.hideInput(),o.setActiveItem(n),e&&e.preventDefault()):o.setCaret(o.caretPos+t))},setCaret:function(t){var e,i,n,o,s=this;if(t="single"===s.settings.mode?s.items.length:Math.max(0,Math.min(s.items.length,t)),!s.isPending)for(e=0,i=(n=s.$control.children(":not(input)")).length;e<i;e++)o=x(n[e]).detach(),e<t?s.$control_input.before(o):s.$control.append(o);s.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.$control_input.prop("disabled",!1).prop("tabindex",t.tabIndex),t.isDisabled=!1,t.unlock()},destroy:function(){var t=this,e=t.eventNS,i=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),t.$control_input.removeData("grow"),t.$input.removeData("selectize"),0==--w.count&&w.$testInput&&(w.$testInput.remove(),w.$testInput=void 0),x(window).off(e),x(document).off(e),x(document.body).off(e),delete t.$input[0].selectize},render:function(t,e){var i,n,o="",s=!1,r=this;return"option"!==t&&"item"!==t||(s=!!(i=I(e[r.settings.valueField]))),s&&(p(r.renderCache[t])||(r.renderCache[t]={}),r.renderCache[t].hasOwnProperty(i))?r.renderCache[t][i]:(o=x(r.settings.render[t].apply(this,[e,a])),"option"===t||"option_create"===t?e[r.settings.disabledField]||o.attr("data-selectable",""):"optgroup"===t&&(n=e[r.settings.optgroupValueField]||"",o.attr("data-group",n),e[r.settings.disabledField]&&o.attr("data-disabled","")),"option"!==t&&"item"!==t||o.attr("data-value",i||""),s&&(r.renderCache[t][i]=o[0]),o[0])},clearCache:function(t){void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){if(!this.settings.create)return!1;var e=this.settings.createFilter;return t.length&&("function"!=typeof e||e.apply(this,[t]))&&("string"!=typeof e||new RegExp(e).test(t))&&(!(e instanceof RegExp)||e.test(t))}}),w.count=0,w.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,isList:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},x.fn.selectize=function(s){function r(t,r){function a(t){var e=c&&t.attr(c);return"string"==typeof e&&e.length?JSON.parse(e):null}function l(t,e){t=x(t);var i=I(t.val());if(i||d.allowEmptyOption)if(u.hasOwnProperty(i)){if(e){var n=u[i][v];n?x.isArray(n)?n.push(e):u[i][v]=[n,e]:u[i][v]=e}}else{var o=a(t)||{};o[h]=o[h]||t.text(),o[g]=o[g]||i,o[f]=o[f]||t.prop("disabled"),o[v]=o[v]||e,u[i]=o,p.push(o),t.is(":selected")&&r.items.push(i)}}function e(t){var e,i,n,o,s;for((n=(t=x(t)).attr("label"))&&((o=a(t)||{})[m]=n,o[y]=n,o[f]=t.prop("disabled"),r.optgroups.push(o)),e=0,i=(s=x("option",t)).length;e<i;e++)l(s[e],n)}var i,n,o,s,p=r.options,u={};for(r.maxItems=t.attr("multiple")?null:1,i=0,n=(s=t.children()).length;i<n;i++)"optgroup"===(o=s[i].tagName.toLowerCase())?e(s[i]):"option"===o&&l(s[i])}var a=x.fn.selectize.defaults,d=x.extend({},a,s),c=d.dataAttr,h=d.labelField,g=d.valueField,f=d.disabledField,v=d.optgroupField,m=d.optgroupLabelField,y=d.optgroupValueField;return this.each(function(){if(!this.selectize){var t,e=x(this),i=this.tagName.toLowerCase(),n=e.attr("placeholder")||e.attr("data-placeholder");n||d.allowEmptyOption||(n=e.children('option[value=""]').text());var o={placeholder:n,options:[],optgroups:[],items:[]};"select"===i?r(e,o):function(t,e){var i,n,o,s,r=t.attr(c);if(r)for(e.options=JSON.parse(r),i=0,n=e.options.length;i<n;i++)e.items.push(e.options[i][g]);else{var a=x.trim(t.val()||"");if(!d.allowEmptyOption&&!a.length)return;for(i=0,n=(o=a.split(d.delimiter)).length;i<n;i++)(s={})[h]=o[i],s[g]=o[i],e.options.push(s);e.items=o}}(e,o),(t=new w(e,x.extend(!0,{},a,o,s))).settings.isList&&t.open()}})},x.fn.selectize.defaults=w.defaults,x.fn.selectize.support={validity:F},w.define("drag_drop",function(t){if(!x.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var e,i,n,o=this;o.lock=(e=o.lock,function(){var t=o.$control.data("sortable");return t&&t.disable(),e.apply(o,arguments)}),o.unlock=(i=o.unlock,function(){var t=o.$control.data("sortable");return t&&t.enable(),i.apply(o,arguments)}),o.setup=(n=o.setup,function(){n.apply(this,arguments);var i=o.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:o.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var t=o.$activeItems?o.$activeItems.slice():null,e=[];i.children("[data-value]").each(function(){e.push(x(this).attr("data-value"))}),o.setValue(e),o.setActiveItem(t)}})})}}),w.define("dropdown_header",function(t){var e,i=this;t=x.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},t),i.setup=(e=i.setup,function(){e.apply(i,arguments),i.$dropdown_header=x(t.html(t)),i.$dropdown.prepend(i.$dropdown_header)})}),w.define("optgroup_columns",function(a){var s,l=this;a=x.extend({equalizeWidth:!0,equalizeHeight:!0},a),this.getAdjacentOption=function(t,e){var i=t.closest("[data-group]").find("[data-selectable]"),n=i.index(t)+e;return 0<=n&&n<i.length?i.eq(n):x()},this.onKeyDown=(s=l.onKeyDown,function(t){var e,i,n,o;return!this.isOpen||37!==t.keyCode&&39!==t.keyCode?s.apply(this,arguments):(l.ignoreHover=!0,e=(o=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),void((i=(n=(o=37===t.keyCode?o.prev("[data-group]"):o.next("[data-group]")).find("[data-selectable]")).eq(Math.min(n.length-1,e))).length&&this.setActiveOption(i)))});function t(){var t,e,i,n,o,s,r;if((e=(r=x("[data-group]",l.$dropdown_content)).length)&&l.$dropdown_content.width()){if(a.equalizeHeight){for(t=i=0;t<e;t++)i=Math.max(i,r.eq(t).height());r.css({height:i})}a.equalizeWidth&&(s=l.$dropdown_content.innerWidth()-p(),n=Math.round(s/e),r.css({width:n}),1<e&&(o=s-n*(e-1),r.eq(e-1).css({width:o})))}}var p=function(){var t,e=p.width,i=document;return void 0===e&&((t=i.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,i.body.appendChild(t),e=p.width=t.offsetWidth-t.clientWidth,i.body.removeChild(t)),e};(a.equalizeHeight||a.equalizeWidth)&&(e.after(this,"positionDropdown",t),e.after(this,"refreshOptions",t))}),w.define("remove_button",function(t){t=x.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var s,e,i,n,r;"single"!==this.settings.mode?(n=s=this,r='<a href="javascript:void(0)" class="'+(e=t).className+'" tabindex="-1" title="'+a(e.title)+'">'+e.label+"</a>",s.setup=(i=n.setup,function(){if(e.append){var o=n.settings.render.item;n.settings.render.item=function(t){return e=o.apply(s,arguments),i=r,n=e.search(/(<\/[^>]+>\s*)$/),e.substring(0,n)+i+e.substring(n);var e,i,n}}i.apply(s,arguments),s.$control.on("click","."+e.className,function(t){if(t.preventDefault(),!n.isLocked){var e=x(t.currentTarget).parent();n.setActiveItem(e),n.deleteSelection()&&n.setCaret(n.items.length)}})})):function(o,e){e.className="remove-single";var i,s=o,r='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+a(e.title)+'">'+e.label+"</a>";o.setup=(i=s.setup,function(){if(e.append){var t=x(s.$input.context).attr("id"),n=(x("#"+t),s.settings.render.item);s.settings.render.item=function(t){return e=n.apply(o,arguments),i=r,x("<span>").append(e).append(i);var e,i}}i.apply(o,arguments),o.$control.on("click","."+e.className,function(t){t.preventDefault(),s.isLocked||s.clear()})})}(this,t)}),w.define("restore_on_backspace",function(n){var o,t=this;n.text=n.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(o=t.onKeyDown,function(t){var e,i;return 8===t.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&0<=(e=this.caretPos-1)&&e<this.items.length?(i=this.options[this.items[e]],this.deleteSelection(t)&&(this.setTextboxValue(n.text.apply(this,[i])),this.refreshOptions(!0)),void t.preventDefault()):o.apply(this,arguments)})}),w});