var carrierActivateWebsocket=null,iqCaptureWebsocket=null,blerCheckWebsocket=null,carrierActivateTabStatusId="activation_status",iqCaptureTabStatusId="capture_iq_status",blerCheckTabStatusId="check_bler_status",runningStatus="Running",stoppedStatus="";$activateCarrierLogContent=$("#activateCarrierLogContent"),$captureIOLogContent=$("#captureIOLogContent");var debugTabs=null,runCarrierActivationBtn=null,startCaptureIQBtn=null,startCheckBlerBtn=null,debugStartText="Start",debugStopText="Stop",blerChart=null,carrierActivateTabName="Carrier Activate",iqCaptureTabName="IQ Data Capture",blerCheckTabName="BLER Check",tabMapping={"Carrier Activate":"0","IQ Data Capture":"1","BLER Check":"2",0:"Carrier Activate",1:"IQ Data Capture",2:"BLER Check"};function getTabName(e){return tabMapping[e.toString()]}function getTabIndex(e){return parseInt(tabMapping[e])}function initDebugComponents(){$("#activateCarrierDiv select").selectmenu(),(debugTabs=new RfTab("#debugTabs",!1)).setActivateCallback(debugTabActivateCallback),(runCarrierActivationBtn=new Button("#runCarrierActivationBtn")).setPrimaryIcon("activateBtn"),runCarrierActivationBtn.setState(!0),runCarrierActivationBtn.bind(function(e){e.preventDefault();var t=runCarrierActivationBtn.getText().trim();t===debugStartText?activateCarrer():t===debugStopText&&showStopCarrierActivateConfirm()}),(startCaptureIQBtn=new Button("#startCaptureIQBtn")).setPrimaryIcon("captureBtn"),startCaptureIQBtn.setState(!0),startCaptureIQBtn.bind(function(e){e.preventDefault();var t=startCaptureIQBtn.getText().trim();t===debugStartText?captureIQ():t===debugStopText&&showStopIqCaptureConfirm()}),(startCheckBlerBtn=new Button("#startCheckBlerBtn")).setPrimaryIcon("checkBtn"),startCheckBlerBtn.setState(!0),startCheckBlerBtn.bind(function(e){e.preventDefault();var t=startCheckBlerBtn.getText().trim();t===debugStartText?checkBler():t===debugStopText&&showStopCheckBlerConfirm()}),blerChart=new RfLineChart("#blerChart","BLER","#3e95cd",!0,50)}function debugTabActivateCallback(){resizeCallback()}function activateCarrer(){var e=$("#activate_type").val(),t=$("#carrier_number").val(),a=$("#carrier_activation_url").val(),r=$("#csrf_token").val();DoAjax(a,"post",{activate_type:e,carrier_number:t,csrf_token:r},activateCarrierSuccessCallback,failedCallback)}function activateCarrierSuccessCallback(e,t,a){var r=e.type;"error"===r?changeState(debugStartText,carrierActivateTabName):"success"===r&&(setTabStatus(carrierActivateTabStatusId,runningStatus),connectCarrierActivateWebsockect(),$activateCarrierLogContent.empty(),changeState(debugStopText,carrierActivateTabName),resizeCallback()),showMsg(e.message)}function captureIQ(){var e=$("#direction").val(),t=$("#cell_number").val(),a=$("#capture_iq_url").val(),r=$("#csrf_token").val();DoAjax(a,"post",{direction:e,cell_number:t,csrf_token:r},captureIQSuccessCallback,failedCallback)}function captureIQSuccessCallback(e,t,a){var r=e.type;"error"===r?changeState(debugStartText,iqCaptureTabName):"success"===r&&(connectIqCaptureWebsockect(),$captureIOLogContent.empty(),changeState(debugStopText,iqCaptureTabName),resizeCallback()),showMsg(e.message)}function checkBler(){var e=$("#check_bler_url").val(),t=$("#csrf_token").val();DoAjax(e,"post",{csrf_token:t},checkBlerSuccessCallback,failedCallback)}function checkBlerSuccessCallback(e,t,a){var r=e.type;"error"===r?changeState(debugStartText,blerCheckTabName):"success"===r&&(blerChart.clearData(),connectBlerCheckWebsockect(),changeState(debugStopText,blerCheckTabName),resizeCallback()),showMsg(e.message)}function showStopCarrierActivateConfirm(){initConfirmBox(stopCarrierActivate),showConfirm("Are your sure to stop running?")}function stopCarrierActivate(){var e=$("#stop_debug_url").val(),t=$("#csrf_token").val();DoAjax(e,"post",{csrf_token:t},stopCarrierActivateSuccessCallback,failedCallback)}function stopCarrierActivateSuccessCallback(e,t,a){var r=e.type;"error"===r?changeState(debugStartText,carrierActivateTabName):"success"===r&&(closeCarrierActivateWebsocket(),changeState(debugStartText,carrierActivateTabName),resizeCallback()),showMsg(e.message)}function showStopIqCaptureConfirm(){initConfirmBox(stopIqCapture),showConfirm("Are your sure to stop running?")}function stopIqCapture(){var e=$("#stop_debug_url").val(),t=$("#csrf_token").val();DoAjax(e,"post",{csrf_token:t},stopIqCaptureSuccessCallback,failedCallback)}function stopIqCaptureSuccessCallback(e,t,a){var r=e.type;"error"===r?changeState(debugStartText,iqCaptureTabName):"success"===r&&(closeIqCaptureWebsocket(),changeState(debugStartText,iqCaptureTabName),resizeCallback()),showMsg(e.message)}function showStopCheckBlerConfirm(){initConfirmBox(stopCheckBler),showConfirm("Are your sure to stop running?")}function stopCheckBler(){var e=$("#stop_check_bler_url").val(),t=$("#csrf_token").val();DoAjax(e,"post",{csrf_token:t},stopBlerCheckSuccessCallback,failedCallback)}function stopBlerCheckSuccessCallback(e,t,a){var r=e.type;"error"===r?changeState(debugStartText,blerCheckTabName):"success"===r&&(closeBlerCheckWebsocket(),changeState(debugStartText,blerCheckTabName),resizeCallback()),showMsg(e.message)}function isCarrierActivateTabRunning(){return isActivationRunning=getTabStatus(carrierActivateTabStatusId)===runningStatus,isActivationRunning}function isIqCaptureTabRunning(){return isCaptureIqRunning=getTabStatus(iqCaptureTabStatusId)===runningStatus,isCaptureIqRunning}function isBlerCheckTabRunning(){return isCheckBlerRunning=getTabStatus(blerCheckTabStatusId)===runningStatus,isCheckBlerRunning}function isThereDebugTabRunning(){return isActivationRunning=isCarrierActivateTabRunning(),isCaptureIqRunning=isIqCaptureTabRunning(),isCheckBlerRunning=isBlerCheckTabRunning(),isActivationRunning||isCaptureIqRunning||isCheckBlerRunning}function disableDebugComponents(){disableTab("runnerLi"),currentDebugTab=getCurrentTab(),currentBtn=runCarrierActivationBtn,currentBtnIcon="activateBtn";var e=getTabIndex(carrierActivateTabName),t=getTabIndex(iqCaptureTabName),a=getTabIndex(blerCheckTabName);currentDebugTab==carrierActivateTabName?($("#carrierActivation select").selectmenu("disable"),debugTabs.disableTab(t),debugTabs.disableTab(a)):currentDebugTab==iqCaptureTabName?debugTabs.disableTab(e):currentDebugTab==blerCheckTabName&&debugTabs.disableTab(e)}function enableDebugComponents(){isThereDebugTabRunning()||enableTab("runnerLi"),currentDebugTab=carrierActivateTabName,crrntDebugTab=getCurrentTab(),crrntDebugTab.length>0&&(currentDebugTab=crrntDebugTab),currentBtn=runCarrierActivationBtn,currentBtnIcon="activateBtn";var e=getTabIndex(carrierActivateTabName),t=getTabIndex(iqCaptureTabName),a=getTabIndex(blerCheckTabName);currentDebugTab==carrierActivateTabName?($("#carrierActivation select").selectmenu("enable"),debugTabs.enableTab(t),debugTabs.enableTab(a)):(currentDebugTab!=iqCaptureTabName||isBlerCheckTabRunning())&&(currentDebugTab!=blerCheckTabName||isIqCaptureTabRunning())||debugTabs.enableTab(e)}function getCurrentTab(){return currentDebugTab=carrierActivateTabName,returnedTab=debugTabs.getCurrentTab(),returnedTab.length>0&&(currentDebugTab=returnedTab),currentDebugTab}function changeState(e,t){if(currentDebugTab=getCurrentTab(),currentBtn=runCarrierActivationBtn,currentBtnIcon="activateBtn",currentDebugTab!=t){var a=getTabIndex(t);debugTabs.setActiveTab(a),currentDebugTab=t}currentDebugTab==carrierActivateTabName?(currentBtn=runCarrierActivationBtn,currentBtnIcon="activateBtn"):currentDebugTab==iqCaptureTabName?(currentBtn=startCaptureIQBtn,currentBtnIcon="captureBtn"):currentDebugTab==blerCheckTabName&&(currentBtn=startCheckBlerBtn,currentBtnIcon="checkBtn"),e===debugStopText?(changeRunningStatus(t,runningStatus),currentBtn.setText(debugStopText),currentBtn.setPrimaryIcon("stopBtn"),disableDebugComponents()):e===debugStartText&&(changeRunningStatus(t,stoppedStatus),currentBtn.setText(debugStartText),currentBtn.setPrimaryIcon(currentBtnIcon),enableDebugComponents())}function changeRunningStatus(e,t){e==carrierActivateTabName?setTabStatus(carrierActivateTabStatusId,t):e==iqCaptureTabName?setTabStatus(iqCaptureTabStatusId,t):e==blerCheckTabName&&setTabStatus(blerCheckTabStatusId,t)}function activateCarrierWSCallback(e){e.startsWith("Done with return code")?(changeState(debugStartText,carrierActivateTabName),showMsg(e),closeCarrierActivateWebsocket()):appendDebugMessage($activateCarrierLogContent,escapeHtml(e))}function captureIqWSCallback(e){e.startsWith("Done with return code")?(changeState(debugStartText,iqCaptureTabName),showMsg(e),closeIqCaptureWebsocket()):appendDebugMessage($captureIOLogContent,escapeHtml(e))}function checkBlerWSCallback(e){var t=e.type,a=e.message;"error"===t?showMsg(a):"os_error"===t?(changeState(debugStartText,blerCheckTabName),showMsg(a),closeBlerCheckWebsocket()):"success"===t&&blerChart.addData(a)}function appendDebugMessage(e,t){e.val().length>0?e.prepend("\n"+t):e.prepend(t)}function initCarrierActivateWebSocket(){debugWebsocket=new RfWebSocket(webSocketFullUrl,"carrier_activation_message"),debugWebsocket.setMessageCallback(activateCarrierWSCallback)}function connectCarrierActivateWebsockect(){carrierActivateWebsocket&&carrierActivateWebsocket.isConnected()||initCarrierActivateWebSocket()}function closeCarrierActivateWebsocket(){carrierActivateWebsocket&&carrierActivateWebsocket.isConnected&&carrierActivateWebsocket.close()}function initIqCaptureWebSocket(){(iqCaptureWebsocket=new RfWebSocket(webSocketFullUrl,"iq_capture_message")).setMessageCallback(captureIqWSCallback)}function connectIqCaptureWebsockect(){iqCaptureWebsocket&&iqCaptureWebsocket.isConnected()||initIqCaptureWebSocket()}function closeIqCaptureWebsocket(){iqCaptureWebsocket&&iqCaptureWebsocket.isConnected&&iqCaptureWebsocket.close()}function initBlerCheckWebSocket(){(blerCheckWebsocket=new RfWebSocket(webSocketFullUrl,"bler_check_message")).setMessageCallback(checkBlerWSCallback)}function connectBlerCheckWebsockect(){blerCheckWebsocket&&blerCheckWebsocket.isConnected()||initBlerCheckWebSocket()}function closeBlerCheckWebsocket(){blerCheckWebsocket&&blerCheckWebsocket.isConnected&&blerCheckWebsocket.close()}function setDebugCompomentInitStatus(){var e=getTabStatus(carrierActivateTabStatusId);if(e===runningStatus){var t=getTabIndex(carrierActivateTabName);debugTabs.setActiveTab(t),changeState(debugStopText,carrierActivateTabName),initCarrierActivateWebSocket()}if((e=getTabStatus(iqCaptureTabStatusId))===runningStatus){t=getTabIndex(iqCaptureTabName);debugTabs.setActiveTab(t),changeState(debugStopText,iqCaptureTabName),initIqCaptureWebSocket()}if((e=getTabStatus(blerCheckTabStatusId))===runningStatus){t=getTabIndex(blerCheckTabName);debugTabs.setActiveTab(t),changeState(debugStopText,blerCheckTabName),initBlerCheckWebSocket()}}function getTabStatus(e){return $("#"+e).val()}function setTabStatus(e,t){$("#"+e).val(t)}