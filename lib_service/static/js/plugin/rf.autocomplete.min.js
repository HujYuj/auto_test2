!function(t,e,o,r){t(function(){var e,r,n,i,a={primaryStyles:["fontFamily","fontSize","fontWeight","fontVariant","fontStyle","paddingLeft","paddingTop","paddingBottom","paddingRight","marginLeft","marginTop","marginBottom","marginRight","borderLeftColor","borderTopColor","borderBottomColor","borderRightColor","borderLeftStyle","borderTopStyle","borderBottomStyle","borderRightStyle","borderLeftWidth","borderTopWidth","borderBottomWidth","borderRightWidth","line-height","outline"],specificStyle:{"word-wrap":"break-word","overflow-x":"hidden","overflow-y":"auto"},simulator:t('<div id="textarea_simulator" contenteditable="true"/>').css({position:"absolute",top:0,left:0,visibility:"hidden"}).appendTo(o.body),toHtml:function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(\s)/g,'<span style="white-space:pre-wrap;">$1</span>')},getCaretPosition:function(){var r=a,n=e,i=n[0],s=n.offset();if(/msie/.test(navigator.userAgent.toLowerCase())){i.focus();var l=o.selection.createRange();return{left:l.boundingLeft-s.left,top:parseInt(l.boundingTop)-s.top+i.scrollTop+o.documentElement.scrollTop+parseInt(n.getComputedStyle("fontSize"))}}r.simulator.empty(),t.each(r.primaryStyles,function(t,e){n.cloneStyle(r.simulator,e)}),r.simulator.css(t.extend({width:n.width(),height:n.height()},r.specificStyle));var u=n.val(),c=n.getCursorPosition(),f=u.substring(0,c),p=u.substring(c),g=t('<span class="before"/>').html(r.toHtml(f)),d=t('<span class="focus"/>'),h=t('<span class="after"/>').html(r.toHtml(p));r.simulator.append(g).append(d).append(h);var m=d.offset(),v=r.simulator.offset();return{top:m.top-v.top-i.scrollTop+(/firefox/.test(navigator.userAgent.toLowerCase())?0:parseInt(n.getComputedStyle("fontSize"))),left:d[0].offsetLeft-r.simulator[0].offsetLeft-i.scrollLeft}}};t.fn.extend({getComputedStyle:function(t){if(0!=this.length){var r=e[0],n=this.css(t);return n=n||(/msie/.test(navigator.userAgent.toLowerCase())?r.currentStyle[t]:o.defaultView.getComputedStyle(r,null)[t])}},cloneStyle:function(e,o){var r=this.getComputedStyle(o);r&&t(e).css(o,r)},cloneAllStyle:function(t,o){var r=e[0];for(var n in r.style){var i=r.style[n];("string"==typeof i||"number"==typeof i)&&this.cloneStyle(t,n)}},getCursorPosition:function(){var r=e[0],n=0;if("selectionStart"in r)n=r.selectionStart;else if("selection"in o){var i=o.selection.createRange();if(!(parseInt(t.browser.version)>6)){var a=o.body.createTextRange();for(a.moveToElementText(r);a.compareEndPoints("StartToStart",i)<0;n++)a.moveStart("character",1);for(var s=0;s<=n;s++)"\n"==r.value.charAt(s)&&n++;return n-=r.value.split("\n").length-1}r.focus();var l=o.selection.createRange().text.length;i.moveStart("character",-r.value.length),n=i.text.length-l}return n},tadAutocomplete:function(o){e=this,r=o,this.autocomplete({source:t.fn.autoCompleteSource,select:function(e,o){var r=e.target;return t.fn.onUserSelected(r,o),e.stopPropagation(),e.preventDefault(),!1},focus:function(t,e){return!1},open:function(e,o){t.fn.initLineStartEnd();var r=e.target,n=t.fn.getCaretPosition();t(".ui-autocomplete:visible").css({top:r.offsetTop+n.top+22})},autoFocus:!0})},autoCompleteSource:function(e,o){var n=t.fn.getCurrentLine();t.ajax({url:r,data:{q:n},success:function(t){var e=t.trim();if(e.length>0){var r=e.split("\n");r.length>0&&o(r)}else o(e)}})},onUserSelected:function(e,o){var r=t(e).val(),a=o.item.value,s=r.substr(0,n),l=r.substr(i),u=e.scrollTop;e.value=s+a+l,t(e).focus(),e.selectionStart=n+a.length,e.selectionEnd=n+a.length,e.scrollTop=u},getCurrentLine:function(){var t=e.val(),o=this.getLineStart(),r=this.getLineEnd();return t.substr(o,r-o)},getLineStart:function(){var t=e[0].value,o=this.getCursorPosition(),r=t.lastIndexOf("\n",o-1);return r>-1?r+1:0},getLineEnd:function(){var t=e[0].value,o=this.getCursorPosition(),r=t.indexOf("\n",o);return r>-1?r:t.length},initLineStartEnd:function(){n=this.getLineStart(),i=this.getLineEnd()},getCaretPosition:a.getCaretPosition})})}(jQuery,window,document);