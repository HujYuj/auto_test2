function UpdateDialog(t,e,a,o,i,s,n){this._updateDialog=$(t),this._versionDialog=$(e),this._forceConfirmDialog=$(a),this._dialogWidth=o,this._processbar=$(i),this._processbarContainer=$(i).parent(),this._processbarLabel=$(i).prev(),this._checkUrl=s,this._updateUrl=n,this._checkVersionCallback,this._beforeSendCallback,this._successCallback,this._errorCallback,this._ajaxRequestData,this._isDialogShown=!1,this._isGoingOn=!1,this._isDone=!1,this._timeout=3e4,this._updateType=this.AUTO_UPDATE_TYPE_AUTO,this._verInfo,this._verMessage,this._updateOKBtnID="updateOKBtn",this._updateUpdateBtnID="updateUpdateBtn",this._updateCancelBtnID="updateCancelBtn",this._updateDetailBtnID="updateDetailBtn",this._request_data;var r=this;this._versionDialog.dialog({resizable:!1,autoOpen:!1,height:"auto",width:r._dialogWidth,modal:!1,open:function(){r.updateVersionDialogPosition()}}),this._versionDialog.dialog("widget").find(".ui-dialog-titlebar").hide(),this._updateDialog.dialog({resizable:!1,autoOpen:!1,height:"auto",width:r._dialogWidth,modal:!0,draggable:!1,buttons:{Update:{text:"Update",id:r._updateUpdateBtnID,click:function(){r.checkStatus(),$(this).dialog("close")}},OK:{text:"OK",id:r._updateOKBtnID,click:function(){$(this).dialog("close")}},Cancel:{text:"Cancel",id:r._updateCancelBtnID,click:function(){$(this).dialog("close")}},Detail:{text:"Detail",id:r._updateDetailBtnID,click:function(){r._versionDialog.dialog("isOpen")?r._versionDialog.dialog("close"):r._versionDialog.dialog("open")}}},close:function(t,e){r._versionDialog.dialog("close")}}),this._forceConfirmDialog.dialog({resizable:!1,autoOpen:!1,height:"auto",width:r._dialogWidth,modal:!0,draggable:!1,buttons:{Yes:{text:"Yes",click:function(){r.update(),$(this).dialog("close")}},No:{text:"No",click:function(){$(this).dialog("close")}}}}),this._processbarContainer.dialog({resizable:!1,autoOpen:!1,height:"auto",width:r._dialogWidth,modal:!0,draggable:!1,buttons:r.processbarContainerCancelButtons}),this._processbarContainer.dialog("widget").find(".ui-dialog-titlebar-close").hide(),this._processbar.progressbar({value:!1,complete:function(){r._processbarContainer.dialog("option","buttons",r.processbarContainerCloseButtons)}})}UpdateDialog.prototype.AUTO_UPDATE_TYPE_AUTO="auto",UpdateDialog.prototype.AUTO_UPDATE_TYPE_MANUAL="manual",UpdateDialog.prototype.setOperationTimeout=function(t){this._timeout=t},UpdateDialog.prototype.setCheckVersionCallback=function(t){this._checkVersionCallback=t},UpdateDialog.prototype.callCheckVersionCallback=function(t,e){this._checkVersionCallback&&this._checkVersionCallback(t,e)},UpdateDialog.prototype.setDialogShown=function(t){this._isDialogShown=t},UpdateDialog.prototype.isGoingOn=function(){return this._isGoingOn},UpdateDialog.prototype.processbarContainerCancelButtons=[{text:"Close",click:function(){$(this).dialog("close")}}],UpdateDialog.prototype.processbarContainerCloseButtons=[{text:"Close",click:function(){$(this).dialog("close")}}],UpdateDialog.prototype.showProcessbar=function(){this._processbarLabel.text("Updating..."),this._processbar.progressbar("option","value",!1),this._processbarContainer.dialog("option","buttons",this.processbarContainerCancelButtons),this._processbarContainer.dialog("open")},UpdateDialog.prototype.setUpdateType=function(t){this._updateType=t},UpdateDialog.prototype.getUpdateType=function(){return this._updateType},UpdateDialog.prototype.checkVersion=function(t,e){if(this._isDone&&t==UpdateDialog.prototype.AUTO_UPDATE_TYPE_MANUAL)this._processbarContainer.dialog("open");else{this._updateType=t||this.AUTO_UPDATE_TYPE_AUTO,e&&(this._request_data=new Array,this._request_data.push(e));var a=new Array;this._request_data&&a.push(this._request_data),a.push("operation=checkVersion");var o=$("#csrf_token").val();a.push("csrf_token="+o);var i=a.join("&").toString();a=null,this._ajaxRequestData=i,this._beforeSendCallback=this.checkVersionBeforeSendCallback,this._successCallback=this.checkVersionSuccCallback,this._errorCallback=this.defaultErrorCallback,this.sendPostAjaxRequest(this._checkUrl)}},UpdateDialog.prototype.checkVersionBeforeSendCallback=function(){this.updateThat._isDialogShown&&this.updateThat._updateType===this.updateThat.AUTO_UPDATE_TYPE_MANUAL&&this.updateThat.showUpdateMessage("Checking version..."),this.updateThat._isGoingOn=!0,this.updateThat._isDone=!1},UpdateDialog.prototype.checkVersionSuccCallback=function(t){var e,a,o,i=!1;if(this.updateThat.isJson(t)){var s=JSON.parse(t);s.version&&s.message?(this.updateThat._verInfo=s.version,a=s.message,e=s.tip,i=!0):s.message&&(o=s.message)}else o=t;i?(this.updateThat.callCheckVersionCallback(!0,this.updateThat._verInfo),this.updateThat._isDialogShown&&(this.updateThat.showUpdateDialog(e,a),this.updateThat.updateType==UpdateDialog.prototype.AUTO_UPDATE_TYPE_AUTO&&this.updateThat.setUpdateType(UpdateDialog.prototype.AUTO_UPDATE_TYPE_MANUAL))):(this.updateThat.callCheckVersionCallback(!1),this.updateThat._isDialogShown&&this.updateThat._updateType===this.updateThat.AUTO_UPDATE_TYPE_MANUAL&&this.updateThat.showUpdateMessage(o)),this.updateThat._isGoingOn=!1},UpdateDialog.prototype.defaultErrorCallback=function(t,e,a){console.info("checkVersion error:"+e);var o=this.updateThat.handleError(t,e,a);this.updateThat._isDialogShown&&this.updateThat._updateType===this.updateThat.AUTO_UPDATE_TYPE_MANUAL&&this.updateThat.showUpdateMessage(o),this.updateThat._isGoingOn=!1},UpdateDialog.prototype.handleError=function(t,e,a){var o=e;return 0==t.status&&"timeout"==e?o="Operation timed out.":0==t.status&&"error"==e?o="No response from server. Please check your network connectivity.":500==t.status?o="Error occured during update, please contact developers.":console.info("Not supported status code:"+t.status+"."),o},UpdateDialog.prototype.showUpdateDialog=function(t,e){$("#"+this._updateOKBtnID).hide(),$("#"+this._updateUpdateBtnID).show(),$("#"+this._updateCancelBtnID).show(),$("#"+this._updateDetailBtnID).show(),this._updateDialog.html(t),this._updateDialog.dialog("open"),this._versionDialog.html(this.getHTMLFormatMessage(e))},UpdateDialog.prototype.showUpdateMessage=function(t){$("#"+this._updateOKBtnID).show(),$("#"+this._updateUpdateBtnID).hide(),$("#"+this._updateCancelBtnID).hide(),$("#"+this._updateDetailBtnID).hide(),this._updateDialog.html(t),this._updateDialog.dialog("open"),this._versionDialog.html(""),this._isGoingOn=!1},UpdateDialog.prototype.getHTMLFormatMessage=function(t){var e=t;return t&&(e=t.replace(/\n/g,"<br>")),e},UpdateDialog.prototype.checkStatus=function(){var t=new Array;this._request_data&&t.push(this._request_data),t.push("operation=checkStatus");var e=t.join("&").toString();t=null,this._ajaxRequestData=e,this._beforeSendCallback=this.checkStatusBeforeSendCallback(),this._successCallback=this.checkStatusSuccCallback,this._errorCallback=this.defaultErrorCallback,this.sendPostAjaxRequest(this._updateUrl)},UpdateDialog.prototype.checkStatusBeforeSendCallback=function(t){this._isGoingOn=!0},UpdateDialog.prototype.checkStatusSuccCallback=function(t){""==t?this.updateThat.update():this.updateThat.isJson(t)&&"status"in JSON.parse(t)?(this.updateThat._forceConfirmDialog.html("Dut Control is running.<br>Would you like to continue updating?"),this.updateThat._forceConfirmDialog.dialog("open")):this.updateThat.showUpdateMessage(t);this.updateThat._isGoingOn=!1},UpdateDialog.prototype.update=function(){var t=new Array;this._request_data&&t.push(this._request_data),t.push("operation=update"),t.push("version="+this._verInfo);var e=t.join("&").toString();t=null,this._ajaxRequestData=e,this._beforeSendCallback=this.updateBeforeSendCallback,this._successCallback=this.updateSuccCallback,this._errorCallback=this.updateErrorCallback,this.sendPostAjaxRequest(this._updateUrl)},UpdateDialog.prototype.updateBeforeSendCallback=function(t){this.updateThat.showProcessbar(),this.updateThat._isGoingOn=!0},UpdateDialog.prototype.updateSuccCallback=function(t){if(console.info("update result:"+t),this.updateThat.isJson(t)){var e,a=JSON.parse(t);e="result"in a?a.result:t,this.updateThat._processbar.progressbar("option","value",100),this.updateThat._processbarLabel.text(e),this.updateThat._processbarContainer.dialog("option","buttons",this.updateThat.processbarContainerCloseButtons),this.updateThat._processbarContainer.dialog("isOpen")||this.updateThat._processbarContainer.dialog("open")}else this.updateThat.showUpdateMessage(t);this.updateThat._isGoingOn=!1,this.updateThat._isDone=!0},UpdateDialog.prototype.updateErrorCallback=function(t,e,a){var o;console.info("update error:"+e),0==t.status&&"error"==e?(o="Update done. Please refresh the page",console.info("TAD GUI was shut down. Connection lost.")):o=this.updateThat.handleError(t,e,a),this.updateThat._processbar.progressbar("option","value",100),this.updateThat._processbarLabel.text(o),this.updateThat._processbarContainer.dialog("option","buttons",this.updateThat.processbarContainerCloseButtons),this.updateThat._processbarContainer.dialog("isOpen")||this.updateThat._processbarContainer.dialog("open"),this.updateThat._isGoingOn=!1,this.updateThat._isDone=!0},UpdateDialog.prototype.getAjaxOptions=function(){return{timeout:this._timeout,type:"POST",data:this._ajaxRequestData,beforeSend:this._beforeSendCallback,success:this._successCallback,error:this._errorCallback,updateThat:this}},UpdateDialog.prototype.sendPostAjaxRequest=function(t){$.ajax(t,this.getAjaxOptions())},UpdateDialog.prototype.updateVersionDialogPosition=function(){var t=this._updateDialog.parent(),e=t.offset(),a=t.outerHeight(),o=e.top+a;this._versionDialog.parent().css({top:o,left:e.left})},UpdateDialog.prototype.isJson=function(t){try{JSON.parse(t)}catch(t){return!1}return!0};